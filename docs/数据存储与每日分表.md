# 数据存储与每日分表实现

## 1. 数据库架构设计

### 核心表结构
- **vehicles**：车辆信息表，存储终端注册信息
- **vehicle_change_logs**：车辆变更日志表，记录字段变更历史
- **jt0200_YYYYMMDD**：定位数据每日分表，存储0x0200报文数据
- **system_config**：系统配置表，存储系统参数

### 每日分表机制
- 定位数据按日期分表存储，表名格式：`jt0200_YYYYMMDD`
- 自动创建当日数据表，支持历史数据查询
- 建立索引优化查询性能

## 2. 核心功能实现

### 数据库管理器（DatabaseManager）
- 数据库初始化与连接管理
- 表结构自动创建
- 事务处理与异常管理

### 定位数据处理
- 解析0x0200报文中的位置信息
- 提取经纬度、速度、方向、时间等关键数据
- 自动存储到对应日期的分表中

### 车辆信息管理
- 解析0x0100终端注册报文
- 自动维护车辆信息表
- 记录字段变更到日志表

## 3. 数据解析扩展

### JT808Parser扩展
- `parse_location_data()`：解析定位信息报文
- `parse_terminal_register()`：解析终端注册报文
- 支持消息体偏移量计算（考虑分包）

### TCP服务集成
- 根据消息ID自动分发处理
- 异步处理避免阻塞主流程
- 详细日志记录处理结果

## 4. 测试验证

### 功能测试
- 数据库初始化测试
- 车辆信息增删改查测试
- 定位数据存储与查询测试
- 每日分表机制验证

### 性能考虑
- 使用索引优化查询性能
- 异步处理提高并发能力
- 连接池管理数据库连接

## 5. 后续优化

- 数据压缩与归档策略
- 历史数据清理机制
- 数据库性能监控
- 数据备份与恢复

如有存储需求变更或性能优化需求，请及时补充本文档。 